[meta]
name = "ultimate-dotfiles"

[tools]
# Outils indispensables au Cockpit
gum = "latest"      # UI Interactif
fzf = "latest"      # Recherche floue
bat = "latest"      # Cat avec syntax highlight
hk = "latest"       # Git Hooks manager
pkl = "latest"      # Config language pour hk
nh = "latest"       # Nix Helper (Speed up builds & GC)
stylua = "latest"   # Formatter Lua (Neovim)
shfmt = "latest"    # Formatter Bash
starship = "latest" # Prompt moderne

[tasks.install]
description = "Bootstrap initial post-clone"
run = """
#!/usr/bin/env bash
set -e
# 1. Installe les hooks git
hk install
# 2. Applique la config Nix initiale
./scripts/cockpit.sh --apply-only
"""

[tasks.ui]
description = "ğŸ–¥ï¸  Ouvre le Cockpit Principal"
alias = "cockpit"
run = "./scripts/cockpit.sh"

[tasks.switch]
description = "ğŸ”„ Applique la config Nix (Rebuild)"
run = "nh os switch ." # nh dÃ©tecte auto si c'est Darwin ou NixOS

[tasks.stow]
description = "ğŸ”— Applique les dotfiles (Symlinks)"
run = "./scripts/stow-apply.sh"

[tasks.save]
description = "â˜ï¸  Snapshot : Git Add + Commit + Push"
run = """
#!/usr/bin/env bash
set -e
git add .
MSG=$(gum input --placeholder "Message de commit...")
git commit -m "$MSG"
git push
"""

[tasks.gc]
description = "ğŸ§¹ Nettoyage du Store Nix"
run = "nh clean all --keep 3" # Garde les 3 derniÃ¨res gÃ©nÃ©rations

[tasks.update]
description = "â¬†ï¸  Met Ã  jour les inputs Flake + Switch"
run = """
#!/usr/bin/env bash
set -e
nix flake update
nh os switch .
"""

[tasks.edit]
description = "âœï¸  Ã‰dite une config (fuzzy finder)"
run = "./scripts/wizards/edit.sh"

[tasks.add]
description = "â• Ajoute une app/host/user"
run = "./scripts/wizards/add-app.sh"

[tasks.secret]
description = "ğŸ”’ GÃ¨re les secrets Fnox"
run = "./scripts/wizards/secret.sh"

[tasks.test-mac]
description = "ğŸ§ª Lance une VM Tart et teste l'installation complÃ¨te"
run = "./scripts/ci/test-darwin.sh"
